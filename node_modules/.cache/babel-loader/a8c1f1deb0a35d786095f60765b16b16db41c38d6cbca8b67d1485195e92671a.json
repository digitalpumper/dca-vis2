{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\lozan\\\\Desktop\\\\Git\\\\dca-spotfire\\\\frontend\\\\src\\\\InteractiveDCAChart.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState, useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst calculateRate = (Qi, b, D, t) => {\n  if (b === 0) {\n    return Qi * Math.exp(-D * t);\n  }\n  return Qi / Math.pow(1 + b * D * t, 1 / b);\n};\nconst fitDeclineParameters = (data, fitWindow = 60) => {\n  var _data$;\n  if (!data || data.length < 3) return {\n    Qi: (data === null || data === void 0 ? void 0 : (_data$ = data[0]) === null || _data$ === void 0 ? void 0 : _data$.value) || 100,\n    b: 0.9,\n    D: 0.01\n  };\n  const sorted = data.slice().sort((a, b) => a.t - b.t);\n  const Qi = sorted[0].value;\n  const recent = sorted.slice(-Math.min(fitWindow, sorted.length));\n  let bestParams = {\n      b: 0,\n      D: 0.01\n    },\n    bestError = Infinity;\n\n  // Coarse search for b\n  for (let b = 0; b <= 1; b += 0.1) {\n    const {\n      D,\n      error\n    } = findOptimalD(recent, Qi, b);\n    if (error < bestError) {\n      bestError = error;\n      bestParams = {\n        b,\n        D\n      };\n    }\n  }\n  // Refine b\n  const bmin = Math.max(0, bestParams.b - 0.1);\n  const bmax = Math.min(1, bestParams.b + 0.1);\n  for (let b = bmin; b <= bmax; b += 0.01) {\n    const {\n      D,\n      error\n    } = findOptimalD(recent, Qi, b);\n    if (error < bestError) {\n      bestError = error;\n      bestParams = {\n        b,\n        D\n      };\n    }\n  }\n  return {\n    Qi,\n    b: bestParams.b,\n    D: bestParams.D\n  };\n};\nfunction findOptimalD(recentData, Qi, b) {\n  let bestD = 0.01,\n    bestError = Infinity;\n  for (let D = 0.001; D <= 0.5; D += 0.005) {\n    let err = 0;\n    for (const d of recentData) {\n      const pred = calculateRate(Qi, b, D, d.t);\n      err += (pred - d.value) ** 2;\n    }\n    if (err < bestError) {\n      bestError = err;\n      bestD = D;\n    }\n  }\n  // Refine around bestD\n  const Dmin = Math.max(0.001, bestD - 0.005);\n  const Dmax = bestD + 0.005;\n  for (let D = Dmin; D <= Dmax; D += 0.0005) {\n    let err = 0;\n    for (const d of recentData) {\n      const pred = calculateRate(Qi, b, D, d.t);\n      err += (pred - d.value) ** 2;\n    }\n    if (err < bestError) {\n      bestError = err;\n      bestD = D;\n    }\n  }\n  return {\n    D: bestD,\n    error: bestError\n  };\n}\n\n// Helper functions moved out to avoid re-declaration in component\nfunction detectDateColumn(columns) {\n  const candidates = columns.filter(h => {\n    const lower = h.toLowerCase();\n    return lower.includes(\"prod\") && lower.includes(\"date\") || lower.includes(\"proddt\") || lower.includes(\"proddttm\") || lower === \"date\" || lower === \"datetime\";\n  });\n  return candidates.length > 0 ? candidates[0] : \"Production_Date\";\n}\nfunction detectColumns(columns) {\n  let phases = {};\n  columns.forEach(header => {\n    const lower = header.toLowerCase();\n    if (lower.includes(\"bopd\") || lower.includes(\"oil\") && !phases.oil) {\n      phases.oil = header;\n    }\n    if (lower.includes(\"bwpd\") || lower.includes(\"water\") && !phases.water) {\n      phases.water = header;\n    }\n    if (lower.includes(\"mcfd\") || lower.includes(\"gas\") && !phases.gas) {\n      phases.gas = header;\n    }\n    if ((lower.includes(\"pip\") || lower.includes(\"pressure\") || lower.includes(\"psi\")) && !phases.pressure) {\n      phases.pressure = header;\n    }\n  });\n  return phases;\n}\nexport default function InteractiveDCAChart({\n  dataString,\n  startDate,\n  endDate,\n  colors,\n  yScaleType,\n  yMultiplier,\n  // Always 1 from parent.\n  forecastDays,\n  autoForecast = true,\n  onParametersCalculated\n}) {\n  _s();\n  const svgRef = useRef(null);\n  const xScaleRef = useRef(null);\n  const yScaleRef = useRef(null); // Store the current y scale\n  const yAxisRef = useRef(null); // Store the y-axis group element\n  const xAxisRef = useRef(null); // Store the x-axis group element\n  const clipPathRef = useRef(null); // For clipping data to plot area\n\n  // Store previous parameter values to prevent redundant updates\n  const prevParamsRef = useRef({});\n  const lastOnParamsCallRef = useRef(null);\n\n  // For tooltip: store hover info.\n  const [hoverInfo, setHoverInfo] = useState(null);\n  // Store current zoom transform for proper axis updates\n  const [zoomTransform, setZoomTransform] = useState(null);\n\n  // Parse CSV data.\n  const parsedData = useMemo(() => {\n    try {\n      return d3.csvParse(dataString);\n    } catch (err) {\n      console.error(\"Error parsing CSV:\", err);\n      return [];\n    }\n  }, [dataString]);\n  const hasData = parsedData.length > 0;\n  const prodDateCol = useMemo(() => hasData ? detectDateColumn(parsedData.columns) : \"Production_Date\", [hasData, parsedData]);\n  const phasesDetected = useMemo(() => hasData ? detectColumns(parsedData.columns) : {}, [hasData, parsedData]);\n  const filteredData = useMemo(() => {\n    if (!hasData) return [];\n    let arr = parsedData.map(row => ({\n      ...row,\n      [prodDateCol]: new Date(row[prodDateCol])\n    })).filter(row => !isNaN(row[prodDateCol].getTime()));\n    arr.sort((a, b) => a[prodDateCol] - b[prodDateCol]);\n    if (startDate) {\n      const sd = new Date(startDate);\n      arr = arr.filter(row => row[prodDateCol] >= sd);\n    }\n    if (endDate) {\n      const ed = new Date(endDate);\n      arr = arr.filter(row => row[prodDateCol] <= ed);\n    }\n    return arr;\n  }, [parsedData, prodDateCol, startDate, endDate, hasData]);\n  const localHasData = filteredData.length > 0;\n  const firstDate = useMemo(() => localHasData ? filteredData[0][prodDateCol] : new Date(), [localHasData, filteredData, prodDateCol]);\n  const data = useMemo(() => {\n    if (!localHasData) return [];\n    return filteredData.map(row => {\n      const date = row[prodDateCol];\n      return {\n        ...row,\n        t: (date - firstDate) / (1000 * 60 * 60 * 24)\n      };\n    });\n  }, [filteredData, localHasData, firstDate, prodDateCol]);\n  const phaseData = useMemo(() => {\n    let result = {};\n    Object.keys(phasesDetected).forEach(phase => {\n      result[phase] = data.map(d => ({\n        t: d.t,\n        value: +d[phasesDetected[phase]]\n      })).filter(d => !isNaN(d.value));\n    });\n    return result;\n  }, [data, phasesDetected]);\n  const tMax = useMemo(() => localHasData ? d3.max(data, d => d.t) : 0, [data, localHasData]);\n  const lastProdDate = useMemo(() => localHasData ? d3.max(data, d => d[prodDateCol]) : new Date(), [data, localHasData, prodDateCol]);\n  const [phaseParams, setPhaseParams] = useState({});\n  const [autoFitEnabled, setAutoFitEnabled] = useState(true);\n  const [activeKey, setActiveKey] = useState(null);\n\n  // Key events for adjusting parameters.\n  useEffect(() => {\n    const handleKeyDown = e => {\n      const key = e.key.toLowerCase();\n      if ([\"d\", \"q\", \"b\"].includes(key)) setActiveKey(key);\n    };\n    const handleKeyUp = () => setActiveKey(null);\n    window.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"keyup\", handleKeyUp);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"keyup\", handleKeyUp);\n    };\n  }, []);\n\n  // Auto-fit decline parameters with memoized input dependencies\n  useEffect(() => {\n    if (!localHasData) return;\n    let newParams = {};\n    Object.keys(phaseData).forEach(phase => {\n      const arr = phaseData[phase];\n      if (arr.length < 3) {\n        var _arr$;\n        newParams[phase] = {\n          Qi: (arr === null || arr === void 0 ? void 0 : (_arr$ = arr[0]) === null || _arr$ === void 0 ? void 0 : _arr$.value) || 100,\n          b: 0.9,\n          D: 0.01\n        };\n      } else {\n        newParams[phase] = fitDeclineParameters(arr);\n      }\n    });\n\n    // Only update state if parameters have actually changed and autofit is enabled\n    if (autoFitEnabled && JSON.stringify(newParams) !== JSON.stringify(prevParamsRef.current)) {\n      prevParamsRef.current = newParams;\n      setPhaseParams(newParams);\n    }\n  }, [phaseData, localHasData, autoFitEnabled]);\n  const calculatedEUR = useMemo(() => {\n    let results = {};\n    Object.keys(phaseParams).forEach(phase => {\n      const {\n        Qi,\n        b,\n        D\n      } = phaseParams[phase];\n      if (b === 0) results[phase] = Qi / D;else if (b > 0 && b < 1) results[phase] = Qi / (D * (1 - b));else if (b === 1) results[phase] = Qi * 10000;else results[phase] = \"N/A\";\n    });\n    return results;\n  }, [phaseParams]);\n\n  // Compute forecast average for first 60 days.\n  const forecastAverage = useMemo(() => {\n    let fa = {};\n    Object.keys(phaseParams).forEach(phase => {\n      const {\n        Qi,\n        b,\n        D\n      } = phaseParams[phase];\n      const Q_start = calculateRate(Qi, b, D, tMax);\n      const steps = 60;\n      let sum = 0;\n      for (let i = 0; i <= steps; i++) {\n        const t = i / steps * 60;\n        const Q = b === 0 ? Q_start * Math.exp(-D * t) : Q_start / Math.pow(1 + b * D * t, 1 / b);\n        sum += Q;\n      }\n      fa[phase] = sum / (steps + 1);\n    });\n    return fa;\n  }, [phaseParams, tMax]);\n\n  // FIX: Use useEffect with proper comparison to prevent infinite loops\n  useEffect(() => {\n    if (onParametersCalculated) {\n      const newParams = {\n        phaseParams,\n        calculatedEUR,\n        forecastAverage\n      };\n      const stringifiedNew = JSON.stringify(newParams);\n      const stringifiedPrev = JSON.stringify(lastOnParamsCallRef.current);\n\n      // Only call the callback if parameters have actually changed\n      if (stringifiedNew !== stringifiedPrev) {\n        lastOnParamsCallRef.current = newParams;\n        onParametersCalculated(newParams);\n      }\n    }\n  }, [phaseParams, calculatedEUR, forecastAverage, onParametersCalculated]);\n  const allHistoricalPoints = useMemo(() => {\n    let out = [];\n    Object.keys(phaseData).forEach(phase => {\n      phaseData[phase].forEach(d => {\n        out.push({\n          date: new Date(firstDate.getTime() + d.t * 86400000),\n          Q: d.value,\n          phase\n        });\n      });\n    });\n    return out;\n  }, [phaseData, firstDate]);\n\n  // Calculate last historical values for each phase to ensure smooth transition\n  const lastHistoricalValues = useMemo(() => {\n    const result = {};\n    Object.keys(phaseData).forEach(phase => {\n      const points = phaseData[phase];\n      if (points.length > 0) {\n        // Sort by time\n        const sorted = [...points].sort((a, b) => a.t - b.t);\n        const lastPoint = sorted[sorted.length - 1];\n        result[phase] = {\n          t: lastPoint.t,\n          value: lastPoint.value,\n          date: new Date(firstDate.getTime() + lastPoint.t * 86400000)\n        };\n      }\n    });\n    return result;\n  }, [phaseData, firstDate]);\n\n  // Improved forecast calculation to ensure smooth transition from historical to forecast\n  function calcForecast(phase, days) {\n    const {\n      Qi,\n      b,\n      D\n    } = phaseParams[phase];\n\n    // Check if we have the last historical point for this phase\n    const lastHistorical = lastHistoricalValues[phase];\n    if (!lastHistorical) return [];\n\n    // Use the actual last value as starting point\n    const Qstart = lastHistorical.value;\n    const tStart = lastHistorical.t;\n    let arr = [];\n    // Add the last historical point as the first forecast point\n    arr.push({\n      date: lastHistorical.date,\n      Q: Qstart,\n      isStart: true\n    });\n    const steps = 50;\n    for (let i = 1; i <= steps; i++) {\n      const dtFraction = i / steps * days;\n      const tVal = tStart + dtFraction;\n\n      // Calculate using relative time from the last historical point\n      const tRelative = dtFraction; // Time since last historical point\n\n      const q = b === 0 ? Qstart * Math.exp(-D * tRelative) : Qstart / Math.pow(1 + b * D * tRelative, 1 / b);\n      const dt = new Date(lastHistorical.date.getTime() + dtFraction * 86400000);\n      arr.push({\n        date: dt,\n        Q: q\n      });\n    }\n    return arr;\n  }\n  const allForecastPoints = useMemo(() => {\n    let out = {};\n    Object.keys(phaseParams).forEach(phase => {\n      const {\n        Qi,\n        b,\n        D\n      } = phaseParams[phase];\n      if (!Qi || D <= 0 || !lastHistoricalValues[phase]) {\n        out[phase] = [];\n      } else {\n        out[phase] = calcForecast(phase, forecastDays).map(obj => ({\n          ...obj,\n          phase\n        }));\n      }\n    });\n    return out;\n  }, [phaseParams, forecastDays, lastHistoricalValues]);\n  const combinedAll = useMemo(() => {\n    let arr = [...allHistoricalPoints];\n    Object.values(allForecastPoints).forEach(a => arr = arr.concat(a));\n    return arr;\n  }, [allHistoricalPoints, allForecastPoints]);\n\n  // Helper function to update chart elements with a transformed y scale\n  const updateChartElements = newYScale => {\n    if (!svgRef.current) return;\n\n    // Store the new scale for tooltip use\n    yScaleRef.current = newYScale;\n\n    // Get the SVG container\n    const svg = d3.select(svgRef.current);\n\n    // Update y-axis with new scale\n    if (yAxisRef.current) {\n      const yAxis = yScaleType === \"log\" ? d3.axisLeft(newYScale).ticks(6, \"~s\") : d3.axisLeft(newYScale);\n      d3.select(yAxisRef.current).call(yAxis);\n    }\n\n    // Update circles (historical data points)\n    svg.selectAll(\"circle\").attr(\"cy\", d => {\n      const y = newYScale(d.Q);\n      return isNaN(y) ? 0 : y;\n    });\n\n    // Update all paths (decline curves and forecasts)\n    svg.selectAll(\"path.data-line\").each(function (d) {\n      if (Array.isArray(d)) {\n        const xScale = xScaleRef.current;\n        if (!xScale) return;\n        const newLineGen = d3.line().x(dd => {\n          const x = xScale(dd.date);\n          return isNaN(x) ? 0 : x;\n        }).y(dd => {\n          const y = newYScale(dd.Q);\n          return isNaN(y) ? 0 : y;\n        }).curve(d3.curveMonotoneX);\n        d3.select(this).attr(\"d\", newLineGen(d));\n      }\n    });\n  };\n\n  // D3 rendering with careful dependency tracking\n  useEffect(() => {\n    if (!localHasData) return;\n    const margin = {\n      top: 20,\n      right: 30,\n      bottom: 40,\n      left: 60\n    };\n    const width = 800;\n    const height = 400;\n    const svg = d3.select(svgRef.current);\n    svg.selectAll(\"*\").remove();\n\n    // Create a clip path to prevent data from crossing the axes\n    svg.append(\"defs\").append(\"clipPath\").attr(\"id\", \"plot-area-clip\").append(\"rect\").attr(\"x\", margin.left).attr(\"y\", margin.top).attr(\"width\", width - margin.left - margin.right).attr(\"height\", height - margin.top - margin.bottom);\n\n    // Create a group for all data elements that should be clipped\n    const chartArea = svg.append(\"g\").attr(\"clip-path\", \"url(#plot-area-clip)\");\n    clipPathRef.current = chartArea.node();\n\n    // Handle possible empty arrays with sensible defaults\n    const dateExtent = d3.extent(combinedAll, d => d.date);\n    const minDateDomain = dateExtent[0] || new Date();\n    const maxDateDomain = dateExtent[1] || new Date();\n    const qExtent = d3.extent(combinedAll, d => d.Q);\n    let minQ = qExtent[0] || 0;\n    let maxQ = qExtent[1] || 100;\n    if (yScaleType === \"log\" && minQ <= 0) minQ = 1e-2;\n\n    // Add 10% padding to y-axis domain\n    if (yScaleType !== \"log\") {\n      const yRange = maxQ - minQ;\n      maxQ = maxQ + yRange * 0.1;\n    }\n    const xScale = d3.scaleTime().domain([minDateDomain, maxDateDomain]).range([margin.left, width - margin.right]);\n    xScaleRef.current = xScale;\n    const yDomain = yScaleType === \"log\" ? [Math.max(1e-5, minQ), maxQ] : [0, maxQ];\n    const yScale = yScaleType === \"log\" ? d3.scaleLog().domain(yDomain).range([height - margin.bottom, margin.top]) : d3.scaleLinear().domain(yDomain).range([height - margin.bottom, margin.top]);\n    yScaleRef.current = yScale;\n\n    // Create a background for the plot area\n    svg.append(\"rect\").attr(\"x\", margin.left).attr(\"y\", margin.top).attr(\"width\", width - margin.left - margin.right).attr(\"height\", height - margin.top - margin.bottom).attr(\"fill\", \"#f8f8f8\").attr(\"stroke\", \"#ccc\").attr(\"stroke-width\", 0.5);\n\n    // Add gridlines\n    chartArea.append(\"g\").attr(\"class\", \"grid y-grid\").attr(\"transform\", `translate(${margin.left},0)`).call(d3.axisLeft(yScale).tickSize(-(width - margin.left - margin.right)).tickFormat(\"\").ticks(5)).selectAll(\"line\").attr(\"stroke\", \"#e0e0e0\");\n    chartArea.append(\"g\").attr(\"class\", \"grid x-grid\").attr(\"transform\", `translate(0,${height - margin.bottom})`).call(d3.axisBottom(xScale).tickSize(-(height - margin.top - margin.bottom)).tickFormat(\"\").ticks(5)).selectAll(\"line\").attr(\"stroke\", \"#e0e0e0\");\n\n    // Plot historical points with NaN safety checks\n    Object.keys(phasesDetected).forEach(phase => {\n      const pts = allHistoricalPoints.filter(o => o.phase === phase);\n      chartArea.selectAll(`circle.hist-${phase}`).data(pts).enter().append(\"circle\").attr(\"class\", `hist-${phase}`).attr(\"cx\", d => {\n        const x = xScale(d.date);\n        return isNaN(x) ? margin.left : x; // Prevent NaN\n      }).attr(\"cy\", d => {\n        const y = yScale(d.Q);\n        return isNaN(y) ? height - margin.bottom : y; // Prevent NaN\n      }).attr(\"r\", 3).attr(\"fill\", colors[phase] || \"#888\");\n    });\n\n    // Plot decline lines with drag behavior.\n    Object.keys(phaseParams).forEach(phase => {\n      const {\n        Qi,\n        b,\n        D\n      } = phaseParams[phase];\n      const lineData = [];\n      const steps = 100;\n      for (let i = 0; i <= steps; i++) {\n        const frac = i / steps;\n        const tVal = tMax * frac;\n        const QVal = calculateRate(Qi, b, D, tVal);\n        const dt = new Date(firstDate.getTime() + tVal * 86400000);\n        lineData.push({\n          date: dt,\n          Q: QVal\n        });\n      }\n\n      // Only draw the line if we have valid data\n      if (lineData.length > 1) {\n        const lineGen = d3.line().x(d => {\n          const x = xScale(d.date);\n          return isNaN(x) ? 0 : x; // Prevent NaN\n        }).y(d => {\n          const y = yScale(d.Q);\n          return isNaN(y) ? 0 : y; // Prevent NaN\n        }).curve(d3.curveMonotoneX);\n        chartArea.append(\"path\").datum(lineData).attr(\"class\", \"data-line decline-curve\").attr(\"fill\", \"none\").attr(\"stroke\", colors[phase] || \"#888888\").attr(\"stroke-width\", 2).style(\"cursor\", \"pointer\").attr(\"d\", lineGen).call(d3.drag().on(\"drag\", event => {\n          if (autoFitEnabled) setAutoFitEnabled(false);\n          setPhaseParams(prev => {\n            const copy = {\n              ...prev\n            };\n            const curr = {\n              ...copy[phase]\n            };\n            if (activeKey === \"d\") {\n              curr.D = Math.max(0.0001, curr.D + event.dy * 0.001);\n            } else if (activeKey === \"q\") {\n              curr.Qi = Math.max(1, curr.Qi - event.dy);\n            } else if (activeKey === \"b\") {\n              curr.b = Math.max(0, Math.min(1, curr.b + event.dy * 0.005));\n            }\n            copy[phase] = curr;\n\n            // Update the chart in real-time during drag\n            setTimeout(() => {\n              // Use the current yScale (may be transformed by zoom)\n              const currentYScale = yScaleRef.current;\n              if (currentYScale) updateChartElements(currentYScale);\n            }, 0);\n            return copy;\n          });\n        }));\n      }\n    });\n\n    // Plot forecast lines with hover/drag effects.\n    Object.keys(allForecastPoints).forEach(phase => {\n      const fc = allForecastPoints[phase];\n      if (fc.length > 1) {\n        const lineGenFc = d3.line().x(d => {\n          const x = xScale(d.date);\n          return isNaN(x) ? 0 : x;\n        }).y(d => {\n          const y = yScale(d.Q);\n          return isNaN(y) ? 0 : y;\n        }).curve(d3.curveMonotoneX);\n        chartArea.append(\"path\").datum(fc).attr(\"class\", \"data-line forecast-curve\").attr(\"fill\", \"none\").attr(\"stroke\", d3.color(colors[phase] || \"#888\").brighter(1.2)).attr(\"stroke-width\", 3).attr(\"stroke-dasharray\", \"5,3\").attr(\"d\", lineGenFc).on(\"mouseover\", function () {\n          d3.select(this).attr(\"stroke-width\", 5);\n        }).on(\"mouseout\", function () {\n          d3.select(this).attr(\"stroke-width\", 3);\n        }).on(\"mousedown\", function () {\n          d3.select(this).style(\"cursor\", \"grabbing\");\n        }).on(\"mouseup\", function () {\n          d3.select(this).style(\"cursor\", \"grab\");\n        });\n      }\n    });\n\n    // Add vertical production cutoff line\n    chartArea.append(\"line\").attr(\"x1\", xScale(lastProdDate)).attr(\"y1\", margin.top).attr(\"x2\", xScale(lastProdDate)).attr(\"y2\", height - margin.bottom).attr(\"stroke\", \"#666\").attr(\"stroke-width\", 1).attr(\"stroke-dasharray\", \"5,5\");\n\n    // Add forecast label\n    chartArea.append(\"text\").attr(\"x\", xScale(lastProdDate) + 5).attr(\"y\", margin.top + 15).attr(\"fill\", \"#666\").text(\"Forecast →\");\n\n    // Add x and y axes AFTER all data elements to ensure they're on top\n    const xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat(\"%Y-%m-%d\"));\n    const xAxisG = svg.append(\"g\").attr(\"transform\", `translate(0,${height - margin.bottom})`).call(xAxis).attr(\"class\", \"x-axis\");\n    xAxisG.selectAll(\"text\").attr(\"transform\", \"rotate(-45)\").style(\"text-anchor\", \"end\");\n    xAxisRef.current = xAxisG.node();\n\n    // Add white background to axes to prevent data bleeding through\n    xAxisG.select(\"path.domain\").attr(\"stroke\", \"#000\").attr(\"stroke-width\", 1.5);\n\n    // Add y-axis with background\n    const yAxis = yScaleType === \"log\" ? d3.axisLeft(yScale).ticks(6, \"~s\") : d3.axisLeft(yScale);\n    const yAxisG = svg.append(\"g\").attr(\"transform\", `translate(${margin.left},0)`).call(yAxis).attr(\"class\", \"y-axis\");\n    yAxisG.select(\"path.domain\").attr(\"stroke\", \"#000\").attr(\"stroke-width\", 1.5);\n    yAxisRef.current = yAxisG.node();\n\n    // Add axis labels\n    svg.append(\"text\").attr(\"x\", width / 2).attr(\"y\", height - 5).style(\"text-anchor\", \"middle\").text(\"Date\");\n    svg.append(\"text\").attr(\"transform\", \"rotate(-90)\").attr(\"x\", -height / 2).attr(\"y\", 15).style(\"text-anchor\", \"middle\").text(\"Production Rate\");\n\n    // d3-zoom for vertical scaling with proper axis updates\n    const zoomBehavior = d3.zoom().scaleExtent([0.5, 10]).on(\"zoom\", event => {\n      setZoomTransform(event.transform);\n\n      // Create the transformed y scale\n      const newYScale = event.transform.rescaleY(yScale);\n\n      // Update all chart elements\n      updateChartElements(newYScale);\n    });\n    svg.call(zoomBehavior);\n\n    // If we have a stored zoom transform, apply it\n    if (zoomTransform) {\n      svg.call(zoomBehavior.transform, zoomTransform);\n    }\n  }, [localHasData, combinedAll, firstDate, lastProdDate, yScaleType, forecastDays, autoFitEnabled, tMax, activeKey, phaseParams, colors, phasesDetected, allHistoricalPoints, allForecastPoints]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: svgRef,\n      width: 800,\n      height: 400,\n      onMouseMove: event => {\n        if (!localHasData || !xScaleRef.current) return;\n        const [mouseX] = d3.pointer(event, svgRef.current);\n        const date = xScaleRef.current.invert(mouseX);\n        const t = (date - firstDate) / 86400000;\n        let vals = {};\n        Object.keys(phaseParams).forEach(phase => {\n          const {\n            Qi,\n            b,\n            D\n          } = phaseParams[phase] || {};\n          if (Qi && b !== undefined && D) {\n            vals[phase] = calculateRate(Qi, b, D, t);\n          }\n        });\n        setHoverInfo({\n          x: mouseX,\n          date,\n          values: vals\n        });\n      },\n      onMouseOut: () => setHoverInfo(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 735,\n      columnNumber: 7\n    }, this), hoverInfo && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        left: hoverInfo.x + 5,\n        top: 0,\n        pointerEvents: 'none',\n        background: 'rgba(255,255,255,0.9)',\n        border: '1px solid #ccc',\n        padding: 5,\n        fontSize: 12,\n        borderRadius: 4\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: hoverInfo.date.toDateString()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 772,\n        columnNumber: 11\n      }, this), Object.keys(hoverInfo.values).map(ph => /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [ph.toUpperCase(), \": \", hoverInfo.values[ph].toFixed(2)]\n      }, ph, true, {\n        fileName: _jsxFileName,\n        lineNumber: 774,\n        columnNumber: 13\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 759,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 734,\n    columnNumber: 5\n  }, this);\n}\n_s(InteractiveDCAChart, \"OG6GQkbL0izIOw2eoxAQr1vJUfQ=\");\n_c = InteractiveDCAChart;\nvar _c;\n$RefreshReg$(_c, \"InteractiveDCAChart\");","map":{"version":3,"names":["React","useRef","useEffect","useState","useMemo","d3","jsxDEV","_jsxDEV","calculateRate","Qi","b","D","t","Math","exp","pow","fitDeclineParameters","data","fitWindow","_data$","length","value","sorted","slice","sort","a","recent","min","bestParams","bestError","Infinity","error","findOptimalD","bmin","max","bmax","recentData","bestD","err","d","pred","Dmin","Dmax","detectDateColumn","columns","candidates","filter","h","lower","toLowerCase","includes","detectColumns","phases","forEach","header","oil","water","gas","pressure","InteractiveDCAChart","dataString","startDate","endDate","colors","yScaleType","yMultiplier","forecastDays","autoForecast","onParametersCalculated","_s","svgRef","xScaleRef","yScaleRef","yAxisRef","xAxisRef","clipPathRef","prevParamsRef","lastOnParamsCallRef","hoverInfo","setHoverInfo","zoomTransform","setZoomTransform","parsedData","csvParse","console","hasData","prodDateCol","phasesDetected","filteredData","arr","map","row","Date","isNaN","getTime","sd","ed","localHasData","firstDate","date","phaseData","result","Object","keys","phase","tMax","lastProdDate","phaseParams","setPhaseParams","autoFitEnabled","setAutoFitEnabled","activeKey","setActiveKey","handleKeyDown","e","key","handleKeyUp","window","addEventListener","removeEventListener","newParams","_arr$","JSON","stringify","current","calculatedEUR","results","forecastAverage","fa","Q_start","steps","sum","i","Q","stringifiedNew","stringifiedPrev","allHistoricalPoints","out","push","lastHistoricalValues","points","lastPoint","calcForecast","days","lastHistorical","Qstart","tStart","isStart","dtFraction","tVal","tRelative","q","dt","allForecastPoints","obj","combinedAll","values","concat","updateChartElements","newYScale","svg","select","yAxis","axisLeft","ticks","call","selectAll","attr","y","each","Array","isArray","xScale","newLineGen","line","x","dd","curve","curveMonotoneX","margin","top","right","bottom","left","width","height","remove","append","chartArea","node","dateExtent","extent","minDateDomain","maxDateDomain","qExtent","minQ","maxQ","yRange","scaleTime","domain","range","yDomain","yScale","scaleLog","scaleLinear","tickSize","tickFormat","axisBottom","pts","o","enter","lineData","frac","QVal","lineGen","datum","style","drag","on","event","prev","copy","curr","dy","setTimeout","currentYScale","fc","lineGenFc","color","brighter","text","xAxis","timeFormat","xAxisG","yAxisG","zoomBehavior","zoom","scaleExtent","transform","rescaleY","position","children","ref","onMouseMove","mouseX","pointer","invert","vals","undefined","onMouseOut","fileName","_jsxFileName","lineNumber","columnNumber","pointerEvents","background","border","padding","fontSize","borderRadius","toDateString","ph","toUpperCase","toFixed","_c","$RefreshReg$"],"sources":["C:/Users/lozan/Desktop/Git/dca-spotfire/frontend/src/InteractiveDCAChart.js"],"sourcesContent":["import React, { useRef, useEffect, useState, useMemo } from 'react';\r\nimport * as d3 from 'd3';\r\n\r\nconst calculateRate = (Qi, b, D, t) => {\r\n  if (b === 0) {\r\n    return Qi * Math.exp(-D * t);\r\n  }\r\n  return Qi / Math.pow(1 + b * D * t, 1 / b);\r\n};\r\n\r\nconst fitDeclineParameters = (data, fitWindow = 60) => {\r\n  if (!data || data.length < 3)\r\n    return { Qi: data?.[0]?.value || 100, b: 0.9, D: 0.01 };\r\n\r\n  const sorted = data.slice().sort((a, b) => a.t - b.t);\r\n  const Qi = sorted[0].value;\r\n  const recent = sorted.slice(-Math.min(fitWindow, sorted.length));\r\n  let bestParams = { b: 0, D: 0.01 }, bestError = Infinity;\r\n\r\n  // Coarse search for b\r\n  for (let b = 0; b <= 1; b += 0.1) {\r\n    const { D, error } = findOptimalD(recent, Qi, b);\r\n    if (error < bestError) {\r\n      bestError = error;\r\n      bestParams = { b, D };\r\n    }\r\n  }\r\n  // Refine b\r\n  const bmin = Math.max(0, bestParams.b - 0.1);\r\n  const bmax = Math.min(1, bestParams.b + 0.1);\r\n  for (let b = bmin; b <= bmax; b += 0.01) {\r\n    const { D, error } = findOptimalD(recent, Qi, b);\r\n    if (error < bestError) {\r\n      bestError = error;\r\n      bestParams = { b, D };\r\n    }\r\n  }\r\n  return { Qi, b: bestParams.b, D: bestParams.D };\r\n};\r\n\r\nfunction findOptimalD(recentData, Qi, b) {\r\n  let bestD = 0.01, bestError = Infinity;\r\n  for (let D = 0.001; D <= 0.5; D += 0.005) {\r\n    let err = 0;\r\n    for (const d of recentData) {\r\n      const pred = calculateRate(Qi, b, D, d.t);\r\n      err += (pred - d.value) ** 2;\r\n    }\r\n    if (err < bestError) {\r\n      bestError = err;\r\n      bestD = D;\r\n    }\r\n  }\r\n  // Refine around bestD\r\n  const Dmin = Math.max(0.001, bestD - 0.005);\r\n  const Dmax = bestD + 0.005;\r\n  for (let D = Dmin; D <= Dmax; D += 0.0005) {\r\n    let err = 0;\r\n    for (const d of recentData) {\r\n      const pred = calculateRate(Qi, b, D, d.t);\r\n      err += (pred - d.value) ** 2;\r\n    }\r\n    if (err < bestError) {\r\n      bestError = err;\r\n      bestD = D;\r\n    }\r\n  }\r\n  return { D: bestD, error: bestError };\r\n}\r\n\r\n// Helper functions moved out to avoid re-declaration in component\r\nfunction detectDateColumn(columns) {\r\n  const candidates = columns.filter(h => {\r\n    const lower = h.toLowerCase();\r\n    return (\r\n      (lower.includes(\"prod\") && lower.includes(\"date\")) ||\r\n      lower.includes(\"proddt\") ||\r\n      lower.includes(\"proddttm\") ||\r\n      lower === \"date\" ||\r\n      lower === \"datetime\"\r\n    );\r\n  });\r\n  return candidates.length > 0 ? candidates[0] : \"Production_Date\";\r\n}\r\n\r\nfunction detectColumns(columns) {\r\n  let phases = {};\r\n  columns.forEach(header => {\r\n    const lower = header.toLowerCase();\r\n    if (lower.includes(\"bopd\") || (lower.includes(\"oil\") && !phases.oil)) {\r\n      phases.oil = header;\r\n    }\r\n    if (lower.includes(\"bwpd\") || (lower.includes(\"water\") && !phases.water)) {\r\n      phases.water = header;\r\n    }\r\n    if (lower.includes(\"mcfd\") || (lower.includes(\"gas\") && !phases.gas)) {\r\n      phases.gas = header;\r\n    }\r\n    if ((lower.includes(\"pip\") || lower.includes(\"pressure\") || lower.includes(\"psi\")) && !phases.pressure) {\r\n      phases.pressure = header;\r\n    }\r\n  });\r\n  return phases;\r\n}\r\n\r\nexport default function InteractiveDCAChart({\r\n  dataString,\r\n  startDate,\r\n  endDate,\r\n  colors,\r\n  yScaleType,\r\n  yMultiplier, // Always 1 from parent.\r\n  forecastDays,\r\n  autoForecast = true,\r\n  onParametersCalculated\r\n}) {\r\n  const svgRef = useRef(null);\r\n  const xScaleRef = useRef(null);\r\n  const yScaleRef = useRef(null); // Store the current y scale\r\n  const yAxisRef = useRef(null); // Store the y-axis group element\r\n  const xAxisRef = useRef(null); // Store the x-axis group element\r\n  const clipPathRef = useRef(null); // For clipping data to plot area\r\n  \r\n  // Store previous parameter values to prevent redundant updates\r\n  const prevParamsRef = useRef({});\r\n  const lastOnParamsCallRef = useRef(null);\r\n  \r\n  // For tooltip: store hover info.\r\n  const [hoverInfo, setHoverInfo] = useState(null);\r\n  // Store current zoom transform for proper axis updates\r\n  const [zoomTransform, setZoomTransform] = useState(null);\r\n\r\n  // Parse CSV data.\r\n  const parsedData = useMemo(() => {\r\n    try {\r\n      return d3.csvParse(dataString);\r\n    } catch (err) {\r\n      console.error(\"Error parsing CSV:\", err);\r\n      return [];\r\n    }\r\n  }, [dataString]);\r\n\r\n  const hasData = parsedData.length > 0;\r\n  const prodDateCol = useMemo(() => \r\n    hasData ? detectDateColumn(parsedData.columns) : \"Production_Date\", \r\n  [hasData, parsedData]);\r\n  \r\n  const phasesDetected = useMemo(() => \r\n    hasData ? detectColumns(parsedData.columns) : {}, \r\n  [hasData, parsedData]);\r\n  \r\n  const filteredData = useMemo(() => {\r\n    if (!hasData) return [];\r\n    let arr = parsedData.map(row => ({\r\n      ...row,\r\n      [prodDateCol]: new Date(row[prodDateCol])\r\n    })).filter(row => !isNaN(row[prodDateCol].getTime()));\r\n    arr.sort((a, b) => a[prodDateCol] - b[prodDateCol]);\r\n    if (startDate) {\r\n      const sd = new Date(startDate);\r\n      arr = arr.filter(row => row[prodDateCol] >= sd);\r\n    }\r\n    if (endDate) {\r\n      const ed = new Date(endDate);\r\n      arr = arr.filter(row => row[prodDateCol] <= ed);\r\n    }\r\n    return arr;\r\n  }, [parsedData, prodDateCol, startDate, endDate, hasData]);\r\n\r\n  const localHasData = filteredData.length > 0;\r\n  const firstDate = useMemo(() => \r\n    localHasData ? filteredData[0][prodDateCol] : new Date(),\r\n  [localHasData, filteredData, prodDateCol]);\r\n\r\n  const data = useMemo(() => {\r\n    if (!localHasData) return [];\r\n    return filteredData.map(row => {\r\n      const date = row[prodDateCol];\r\n      return { ...row, t: (date - firstDate) / (1000 * 60 * 60 * 24) };\r\n    });\r\n  }, [filteredData, localHasData, firstDate, prodDateCol]);\r\n\r\n  const phaseData = useMemo(() => {\r\n    let result = {};\r\n    Object.keys(phasesDetected).forEach(phase => {\r\n      result[phase] = data.map(d => ({\r\n        t: d.t,\r\n        value: +d[phasesDetected[phase]]\r\n      })).filter(d => !isNaN(d.value));\r\n    });\r\n    return result;\r\n  }, [data, phasesDetected]);\r\n\r\n  const tMax = useMemo(() => \r\n    localHasData ? d3.max(data, d => d.t) : 0,\r\n  [data, localHasData]);\r\n  \r\n  const lastProdDate = useMemo(() => \r\n    localHasData ? d3.max(data, d => d[prodDateCol]) : new Date(),\r\n  [data, localHasData, prodDateCol]);\r\n\r\n  const [phaseParams, setPhaseParams] = useState({});\r\n  const [autoFitEnabled, setAutoFitEnabled] = useState(true);\r\n  const [activeKey, setActiveKey] = useState(null);\r\n\r\n  // Key events for adjusting parameters.\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      const key = e.key.toLowerCase();\r\n      if ([\"d\", \"q\", \"b\"].includes(key)) setActiveKey(key);\r\n    };\r\n    const handleKeyUp = () => setActiveKey(null);\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    window.addEventListener(\"keyup\", handleKeyUp);\r\n    return () => {\r\n      window.removeEventListener(\"keydown\", handleKeyDown);\r\n      window.removeEventListener(\"keyup\", handleKeyUp);\r\n    };\r\n  }, []);\r\n\r\n  // Auto-fit decline parameters with memoized input dependencies\r\n  useEffect(() => {\r\n    if (!localHasData) return;\r\n    \r\n    let newParams = {};\r\n    Object.keys(phaseData).forEach(phase => {\r\n      const arr = phaseData[phase];\r\n      if (arr.length < 3) {\r\n        newParams[phase] = { Qi: arr?.[0]?.value || 100, b: 0.9, D: 0.01 };\r\n      } else {\r\n        newParams[phase] = fitDeclineParameters(arr);\r\n      }\r\n    });\r\n    \r\n    // Only update state if parameters have actually changed and autofit is enabled\r\n    if (autoFitEnabled && JSON.stringify(newParams) !== JSON.stringify(prevParamsRef.current)) {\r\n      prevParamsRef.current = newParams;\r\n      setPhaseParams(newParams);\r\n    }\r\n  }, [phaseData, localHasData, autoFitEnabled]);\r\n\r\n  const calculatedEUR = useMemo(() => {\r\n    let results = {};\r\n    Object.keys(phaseParams).forEach(phase => {\r\n      const { Qi, b, D } = phaseParams[phase];\r\n      if (b === 0) results[phase] = Qi / D;\r\n      else if (b > 0 && b < 1) results[phase] = Qi / (D * (1 - b));\r\n      else if (b === 1) results[phase] = Qi * 10000;\r\n      else results[phase] = \"N/A\";\r\n    });\r\n    return results;\r\n  }, [phaseParams]);\r\n\r\n  // Compute forecast average for first 60 days.\r\n  const forecastAverage = useMemo(() => {\r\n    let fa = {};\r\n    Object.keys(phaseParams).forEach(phase => {\r\n      const { Qi, b, D } = phaseParams[phase];\r\n      const Q_start = calculateRate(Qi, b, D, tMax);\r\n      const steps = 60;\r\n      let sum = 0;\r\n      for (let i = 0; i <= steps; i++) {\r\n        const t = (i / steps) * 60;\r\n        const Q = b === 0 ? Q_start * Math.exp(-D * t) : Q_start / Math.pow(1 + b * D * t, 1 / b);\r\n        sum += Q;\r\n      }\r\n      fa[phase] = sum / (steps + 1);\r\n    });\r\n    return fa;\r\n  }, [phaseParams, tMax]);\r\n\r\n  // FIX: Use useEffect with proper comparison to prevent infinite loops\r\n  useEffect(() => {\r\n    if (onParametersCalculated) {\r\n      const newParams = { phaseParams, calculatedEUR, forecastAverage };\r\n      const stringifiedNew = JSON.stringify(newParams);\r\n      const stringifiedPrev = JSON.stringify(lastOnParamsCallRef.current);\r\n      \r\n      // Only call the callback if parameters have actually changed\r\n      if (stringifiedNew !== stringifiedPrev) {\r\n        lastOnParamsCallRef.current = newParams;\r\n        onParametersCalculated(newParams);\r\n      }\r\n    }\r\n  }, [phaseParams, calculatedEUR, forecastAverage, onParametersCalculated]);\r\n\r\n  const allHistoricalPoints = useMemo(() => {\r\n    let out = [];\r\n    Object.keys(phaseData).forEach(phase => {\r\n      phaseData[phase].forEach(d => {\r\n        out.push({\r\n          date: new Date(firstDate.getTime() + d.t * 86400000),\r\n          Q: d.value,\r\n          phase\r\n        });\r\n      });\r\n    });\r\n    return out;\r\n  }, [phaseData, firstDate]);\r\n\r\n  // Calculate last historical values for each phase to ensure smooth transition\r\n  const lastHistoricalValues = useMemo(() => {\r\n    const result = {};\r\n    Object.keys(phaseData).forEach(phase => {\r\n      const points = phaseData[phase];\r\n      if (points.length > 0) {\r\n        // Sort by time\r\n        const sorted = [...points].sort((a, b) => a.t - b.t);\r\n        const lastPoint = sorted[sorted.length - 1];\r\n        result[phase] = {\r\n          t: lastPoint.t,\r\n          value: lastPoint.value,\r\n          date: new Date(firstDate.getTime() + lastPoint.t * 86400000)\r\n        };\r\n      }\r\n    });\r\n    return result;\r\n  }, [phaseData, firstDate]);\r\n\r\n  // Improved forecast calculation to ensure smooth transition from historical to forecast\r\n  function calcForecast(phase, days) {\r\n    const { Qi, b, D } = phaseParams[phase];\r\n    \r\n    // Check if we have the last historical point for this phase\r\n    const lastHistorical = lastHistoricalValues[phase];\r\n    if (!lastHistorical) return [];\r\n    \r\n    // Use the actual last value as starting point\r\n    const Qstart = lastHistorical.value;\r\n    const tStart = lastHistorical.t;\r\n    \r\n    let arr = [];\r\n    // Add the last historical point as the first forecast point\r\n    arr.push({ date: lastHistorical.date, Q: Qstart, isStart: true });\r\n    \r\n    const steps = 50;\r\n    for (let i = 1; i <= steps; i++) {\r\n      const dtFraction = (i / steps) * days;\r\n      const tVal = tStart + dtFraction;\r\n      \r\n      // Calculate using relative time from the last historical point\r\n      const tRelative = dtFraction; // Time since last historical point\r\n      \r\n      const q = b === 0 \r\n        ? Qstart * Math.exp(-D * tRelative) \r\n        : Qstart / Math.pow(1 + b * D * tRelative, 1 / b);\r\n        \r\n      const dt = new Date(lastHistorical.date.getTime() + dtFraction * 86400000);\r\n      arr.push({ date: dt, Q: q });\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  const allForecastPoints = useMemo(() => {\r\n    let out = {};\r\n    Object.keys(phaseParams).forEach(phase => {\r\n      const { Qi, b, D } = phaseParams[phase];\r\n      if (!Qi || D <= 0 || !lastHistoricalValues[phase]) {\r\n        out[phase] = [];\r\n      } else {\r\n        out[phase] = calcForecast(phase, forecastDays).map(obj => ({\r\n          ...obj,\r\n          phase\r\n        }));\r\n      }\r\n    });\r\n    return out;\r\n  }, [phaseParams, forecastDays, lastHistoricalValues]);\r\n\r\n  const combinedAll = useMemo(() => {\r\n    let arr = [...allHistoricalPoints];\r\n    Object.values(allForecastPoints).forEach(a => (arr = arr.concat(a)));\r\n    return arr;\r\n  }, [allHistoricalPoints, allForecastPoints]);\r\n\r\n  // Helper function to update chart elements with a transformed y scale\r\n  const updateChartElements = (newYScale) => {\r\n    if (!svgRef.current) return;\r\n    \r\n    // Store the new scale for tooltip use\r\n    yScaleRef.current = newYScale;\r\n    \r\n    // Get the SVG container\r\n    const svg = d3.select(svgRef.current);\r\n    \r\n    // Update y-axis with new scale\r\n    if (yAxisRef.current) {\r\n      const yAxis = yScaleType === \"log\" \r\n        ? d3.axisLeft(newYScale).ticks(6, \"~s\") \r\n        : d3.axisLeft(newYScale);\r\n      \r\n      d3.select(yAxisRef.current).call(yAxis);\r\n    }\r\n    \r\n    // Update circles (historical data points)\r\n    svg.selectAll(\"circle\").attr(\"cy\", d => {\r\n      const y = newYScale(d.Q);\r\n      return isNaN(y) ? 0 : y;\r\n    });\r\n    \r\n    // Update all paths (decline curves and forecasts)\r\n    svg.selectAll(\"path.data-line\").each(function(d) {\r\n      if (Array.isArray(d)) {\r\n        const xScale = xScaleRef.current;\r\n        if (!xScale) return;\r\n        \r\n        const newLineGen = d3.line()\r\n          .x(dd => {\r\n            const x = xScale(dd.date);\r\n            return isNaN(x) ? 0 : x;\r\n          })\r\n          .y(dd => {\r\n            const y = newYScale(dd.Q);\r\n            return isNaN(y) ? 0 : y;\r\n          })\r\n          .curve(d3.curveMonotoneX);\r\n          \r\n        d3.select(this).attr(\"d\", newLineGen(d));\r\n      }\r\n    });\r\n  };\r\n\r\n  // D3 rendering with careful dependency tracking\r\n  useEffect(() => {\r\n    if (!localHasData) return;\r\n    \r\n    const margin = { top: 20, right: 30, bottom: 40, left: 60 };\r\n    const width = 800;\r\n    const height = 400;\r\n    const svg = d3.select(svgRef.current);\r\n    svg.selectAll(\"*\").remove();\r\n\r\n    // Create a clip path to prevent data from crossing the axes\r\n    svg.append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"plot-area-clip\")\r\n      .append(\"rect\")\r\n      .attr(\"x\", margin.left)\r\n      .attr(\"y\", margin.top)\r\n      .attr(\"width\", width - margin.left - margin.right)\r\n      .attr(\"height\", height - margin.top - margin.bottom);\r\n    \r\n    // Create a group for all data elements that should be clipped\r\n    const chartArea = svg.append(\"g\")\r\n      .attr(\"clip-path\", \"url(#plot-area-clip)\");\r\n    \r\n    clipPathRef.current = chartArea.node();\r\n\r\n    // Handle possible empty arrays with sensible defaults\r\n    const dateExtent = d3.extent(combinedAll, d => d.date);\r\n    const minDateDomain = dateExtent[0] || new Date();\r\n    const maxDateDomain = dateExtent[1] || new Date();\r\n    \r\n    const qExtent = d3.extent(combinedAll, d => d.Q);\r\n    let minQ = qExtent[0] || 0;\r\n    let maxQ = qExtent[1] || 100;\r\n    \r\n    if (yScaleType === \"log\" && minQ <= 0) minQ = 1e-2;\r\n    \r\n    // Add 10% padding to y-axis domain\r\n    if (yScaleType !== \"log\") {\r\n      const yRange = maxQ - minQ;\r\n      maxQ = maxQ + yRange * 0.1;\r\n    }\r\n    \r\n    const xScale = d3.scaleTime()\r\n      .domain([minDateDomain, maxDateDomain])\r\n      .range([margin.left, width - margin.right]);\r\n      \r\n    xScaleRef.current = xScale;\r\n    \r\n    const yDomain = yScaleType === \"log\" ? [Math.max(1e-5, minQ), maxQ] : [0, maxQ];\r\n    const yScale = yScaleType === \"log\"\r\n      ? d3.scaleLog().domain(yDomain).range([height - margin.bottom, margin.top])\r\n      : d3.scaleLinear().domain(yDomain).range([height - margin.bottom, margin.top]);\r\n      \r\n    yScaleRef.current = yScale;\r\n\r\n    // Create a background for the plot area\r\n    svg.append(\"rect\")\r\n      .attr(\"x\", margin.left)\r\n      .attr(\"y\", margin.top)\r\n      .attr(\"width\", width - margin.left - margin.right)\r\n      .attr(\"height\", height - margin.top - margin.bottom)\r\n      .attr(\"fill\", \"#f8f8f8\")\r\n      .attr(\"stroke\", \"#ccc\")\r\n      .attr(\"stroke-width\", 0.5);\r\n    \r\n    // Add gridlines\r\n    chartArea.append(\"g\")\r\n      .attr(\"class\", \"grid y-grid\")\r\n      .attr(\"transform\", `translate(${margin.left},0)`)\r\n      .call(\r\n        d3.axisLeft(yScale)\r\n          .tickSize(-(width - margin.left - margin.right))\r\n          .tickFormat(\"\")\r\n          .ticks(5)\r\n      )\r\n      .selectAll(\"line\")\r\n      .attr(\"stroke\", \"#e0e0e0\");\r\n    \r\n    chartArea.append(\"g\")\r\n      .attr(\"class\", \"grid x-grid\")\r\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\r\n      .call(\r\n        d3.axisBottom(xScale)\r\n          .tickSize(-(height - margin.top - margin.bottom))\r\n          .tickFormat(\"\")\r\n          .ticks(5)\r\n      )\r\n      .selectAll(\"line\")\r\n      .attr(\"stroke\", \"#e0e0e0\");\r\n\r\n    // Plot historical points with NaN safety checks\r\n    Object.keys(phasesDetected).forEach(phase => {\r\n      const pts = allHistoricalPoints.filter(o => o.phase === phase);\r\n      chartArea.selectAll(`circle.hist-${phase}`)\r\n        .data(pts)\r\n        .enter()\r\n        .append(\"circle\")\r\n        .attr(\"class\", `hist-${phase}`)\r\n        .attr(\"cx\", d => {\r\n          const x = xScale(d.date);\r\n          return isNaN(x) ? margin.left : x; // Prevent NaN\r\n        })\r\n        .attr(\"cy\", d => {\r\n          const y = yScale(d.Q);\r\n          return isNaN(y) ? height - margin.bottom : y; // Prevent NaN\r\n        })\r\n        .attr(\"r\", 3)\r\n        .attr(\"fill\", colors[phase] || \"#888\");\r\n    });\r\n\r\n    // Plot decline lines with drag behavior.\r\n    Object.keys(phaseParams).forEach(phase => {\r\n      const { Qi, b, D } = phaseParams[phase];\r\n      const lineData = [];\r\n      const steps = 100;\r\n      for (let i = 0; i <= steps; i++) {\r\n        const frac = i / steps;\r\n        const tVal = tMax * frac;\r\n        const QVal = calculateRate(Qi, b, D, tVal);\r\n        const dt = new Date(firstDate.getTime() + tVal * 86400000);\r\n        lineData.push({ date: dt, Q: QVal });\r\n      }\r\n      \r\n      // Only draw the line if we have valid data\r\n      if (lineData.length > 1) {\r\n        const lineGen = d3.line()\r\n          .x(d => {\r\n            const x = xScale(d.date);\r\n            return isNaN(x) ? 0 : x; // Prevent NaN\r\n          })\r\n          .y(d => {\r\n            const y = yScale(d.Q);\r\n            return isNaN(y) ? 0 : y; // Prevent NaN\r\n          })\r\n          .curve(d3.curveMonotoneX);\r\n          \r\n        chartArea.append(\"path\")\r\n          .datum(lineData)\r\n          .attr(\"class\", \"data-line decline-curve\")\r\n          .attr(\"fill\", \"none\")\r\n          .attr(\"stroke\", colors[phase] || \"#888888\")\r\n          .attr(\"stroke-width\", 2)\r\n          .style(\"cursor\", \"pointer\")\r\n          .attr(\"d\", lineGen)\r\n          .call(\r\n            d3.drag().on(\"drag\", (event) => {\r\n              if (autoFitEnabled) setAutoFitEnabled(false);\r\n              setPhaseParams(prev => {\r\n                const copy = { ...prev };\r\n                const curr = { ...copy[phase] };\r\n                if (activeKey === \"d\") {\r\n                  curr.D = Math.max(0.0001, curr.D + event.dy * 0.001);\r\n                } else if (activeKey === \"q\") {\r\n                  curr.Qi = Math.max(1, curr.Qi - event.dy);\r\n                } else if (activeKey === \"b\") {\r\n                  curr.b = Math.max(0, Math.min(1, curr.b + event.dy * 0.005));\r\n                }\r\n                copy[phase] = curr;\r\n                \r\n                // Update the chart in real-time during drag\r\n                setTimeout(() => {\r\n                  // Use the current yScale (may be transformed by zoom)\r\n                  const currentYScale = yScaleRef.current;\r\n                  if (currentYScale) updateChartElements(currentYScale);\r\n                }, 0);\r\n                \r\n                return copy;\r\n              });\r\n            })\r\n          );\r\n      }\r\n    });\r\n\r\n    // Plot forecast lines with hover/drag effects.\r\n    Object.keys(allForecastPoints).forEach(phase => {\r\n      const fc = allForecastPoints[phase];\r\n      if (fc.length > 1) {\r\n        const lineGenFc = d3.line()\r\n          .x(d => {\r\n            const x = xScale(d.date);\r\n            return isNaN(x) ? 0 : x;\r\n          })\r\n          .y(d => {\r\n            const y = yScale(d.Q);\r\n            return isNaN(y) ? 0 : y;\r\n          })\r\n          .curve(d3.curveMonotoneX);\r\n          \r\n        chartArea.append(\"path\")\r\n          .datum(fc)\r\n          .attr(\"class\", \"data-line forecast-curve\")\r\n          .attr(\"fill\", \"none\")\r\n          .attr(\"stroke\", d3.color(colors[phase] || \"#888\").brighter(1.2))\r\n          .attr(\"stroke-width\", 3)\r\n          .attr(\"stroke-dasharray\", \"5,3\")\r\n          .attr(\"d\", lineGenFc)\r\n          .on(\"mouseover\", function() {\r\n            d3.select(this).attr(\"stroke-width\", 5);\r\n          })\r\n          .on(\"mouseout\", function() {\r\n            d3.select(this).attr(\"stroke-width\", 3);\r\n          })\r\n          .on(\"mousedown\", function() {\r\n            d3.select(this).style(\"cursor\", \"grabbing\");\r\n          })\r\n          .on(\"mouseup\", function() {\r\n            d3.select(this).style(\"cursor\", \"grab\");\r\n          });\r\n      }\r\n    });\r\n\r\n    // Add vertical production cutoff line\r\n    chartArea.append(\"line\")\r\n      .attr(\"x1\", xScale(lastProdDate))\r\n      .attr(\"y1\", margin.top)\r\n      .attr(\"x2\", xScale(lastProdDate))\r\n      .attr(\"y2\", height - margin.bottom)\r\n      .attr(\"stroke\", \"#666\")\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"stroke-dasharray\", \"5,5\");\r\n      \r\n    // Add forecast label\r\n    chartArea.append(\"text\")\r\n      .attr(\"x\", xScale(lastProdDate) + 5)\r\n      .attr(\"y\", margin.top + 15)\r\n      .attr(\"fill\", \"#666\")\r\n      .text(\"Forecast →\");\r\n    \r\n    // Add x and y axes AFTER all data elements to ensure they're on top\r\n    const xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat(\"%Y-%m-%d\"));\r\n    const xAxisG = svg.append(\"g\")\r\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\r\n      .call(xAxis)\r\n      .attr(\"class\", \"x-axis\");\r\n      \r\n    xAxisG.selectAll(\"text\")\r\n      .attr(\"transform\", \"rotate(-45)\")\r\n      .style(\"text-anchor\", \"end\");\r\n      \r\n    xAxisRef.current = xAxisG.node();\r\n    \r\n    // Add white background to axes to prevent data bleeding through\r\n    xAxisG.select(\"path.domain\")\r\n      .attr(\"stroke\", \"#000\")\r\n      .attr(\"stroke-width\", 1.5);\r\n      \r\n    // Add y-axis with background\r\n    const yAxis = yScaleType === \"log\" ? d3.axisLeft(yScale).ticks(6, \"~s\") : d3.axisLeft(yScale);\r\n    const yAxisG = svg.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},0)`)\r\n      .call(yAxis)\r\n      .attr(\"class\", \"y-axis\");\r\n      \r\n    yAxisG.select(\"path.domain\")\r\n      .attr(\"stroke\", \"#000\")\r\n      .attr(\"stroke-width\", 1.5);\r\n      \r\n    yAxisRef.current = yAxisG.node();\r\n      \r\n    // Add axis labels\r\n    svg.append(\"text\")\r\n      .attr(\"x\", width / 2)\r\n      .attr(\"y\", height - 5)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .text(\"Date\");\r\n      \r\n    svg.append(\"text\")\r\n      .attr(\"transform\", \"rotate(-90)\")\r\n      .attr(\"x\", -height / 2)\r\n      .attr(\"y\", 15)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .text(\"Production Rate\");\r\n\r\n    // d3-zoom for vertical scaling with proper axis updates\r\n    const zoomBehavior = d3.zoom()\r\n      .scaleExtent([0.5, 10])\r\n      .on(\"zoom\", (event) => {\r\n        setZoomTransform(event.transform);\r\n        \r\n        // Create the transformed y scale\r\n        const newYScale = event.transform.rescaleY(yScale);\r\n        \r\n        // Update all chart elements\r\n        updateChartElements(newYScale);\r\n      });\r\n      \r\n    svg.call(zoomBehavior);\r\n    \r\n    // If we have a stored zoom transform, apply it\r\n    if (zoomTransform) {\r\n      svg.call(zoomBehavior.transform, zoomTransform);\r\n    }\r\n  }, [\r\n    localHasData,\r\n    combinedAll,\r\n    firstDate,\r\n    lastProdDate,\r\n    yScaleType,\r\n    forecastDays,\r\n    autoFitEnabled,\r\n    tMax,\r\n    activeKey,\r\n    phaseParams,\r\n    colors,\r\n    phasesDetected,\r\n    allHistoricalPoints,\r\n    allForecastPoints\r\n  ]);\r\n\r\n  return (\r\n    <div style={{ position: 'relative' }}>\r\n      <svg\r\n        ref={svgRef}\r\n        width={800}\r\n        height={400}\r\n        onMouseMove={(event) => {\r\n          if (!localHasData || !xScaleRef.current) return;\r\n          \r\n          const [mouseX] = d3.pointer(event, svgRef.current);\r\n          const date = xScaleRef.current.invert(mouseX);\r\n          const t = (date - firstDate) / 86400000;\r\n          \r\n          let vals = {};\r\n          Object.keys(phaseParams).forEach(phase => {\r\n            const { Qi, b, D } = phaseParams[phase] || {};\r\n            if (Qi && b !== undefined && D) {\r\n              vals[phase] = calculateRate(Qi, b, D, t);\r\n            }\r\n          });\r\n          \r\n          setHoverInfo({ x: mouseX, date, values: vals });\r\n        }}\r\n        onMouseOut={() => setHoverInfo(null)}\r\n      />\r\n      {hoverInfo && (\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            left: hoverInfo.x + 5,\r\n            top: 0,\r\n            pointerEvents: 'none',\r\n            background: 'rgba(255,255,255,0.9)',\r\n            border: '1px solid #ccc',\r\n            padding: 5,\r\n            fontSize: 12,\r\n            borderRadius: 4\r\n          }}\r\n        >\r\n          <div>{hoverInfo.date.toDateString()}</div>\r\n          {Object.keys(hoverInfo.values).map(ph => (\r\n            <div key={ph}>\r\n              {ph.toUpperCase()}: {hoverInfo.values[ph].toFixed(2)}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}