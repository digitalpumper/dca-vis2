{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\lozan\\\\Desktop\\\\Git\\\\dca-spotfire\\\\frontend\\\\src\\\\InteractiveDCAChart.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState, useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst darkenColor = (hex, factor = 0.8) => {\n  let c = d3.color(hex);\n  if (c) {\n    c.r = Math.floor(c.r * factor);\n    c.g = Math.floor(c.g * factor);\n    c.b = Math.floor(c.b * factor);\n    return c.formatHex();\n  }\n  return hex;\n};\nconst lightenColor = (hex, factor = 1.2) => {\n  let c = d3.color(hex);\n  if (c) {\n    c.r = Math.min(255, Math.floor(c.r * factor));\n    c.g = Math.min(255, Math.floor(c.g * factor));\n    c.b = Math.min(255, Math.floor(c.b * factor));\n    return c.formatHex();\n  }\n  return hex;\n};\nconst detectDateColumn = headers => {\n  const candidates = headers.filter(h => {\n    const lower = h.toLowerCase();\n    return lower.includes(\"prod\") && lower.includes(\"date\") || lower.includes(\"proddt\") || lower.includes(\"proddttm\") || lower === \"date\" || lower === \"datetime\";\n  });\n  return candidates.length > 0 ? candidates[0] : \"Production_Date\";\n};\nconst detectColumns = headers => {\n  let phases = {};\n  headers.forEach(header => {\n    const lower = header.toLowerCase();\n    if (lower.includes(\"bopd\")) {\n      phases.oil = header;\n    } else if (lower.includes(\"oil\") && !phases.oil) {\n      phases.oil = header;\n    }\n    if (lower.includes(\"bwpd\")) {\n      phases.water = header;\n    } else if (lower.includes(\"water\") && !phases.water) {\n      phases.water = header;\n    }\n    if (lower.includes(\"mcfd\")) {\n      phases.gas = header;\n    } else if (lower.includes(\"gas\") && !phases.gas) {\n      phases.gas = header;\n    }\n    if ((lower.includes(\"pip\") || lower.includes(\"pressure\") || lower.includes(\"psi\")) && !phases.pressure) {\n      phases.pressure = header;\n    }\n  });\n  return phases;\n};\nconst calculateRate = (Qi, b, D, t) => {\n  if (b === 0) {\n    return Qi * Math.exp(-D * t);\n  } else {\n    return Qi / Math.pow(1 + b * D * t, 1 / b);\n  }\n};\nconst fitDeclineParameters = (data, fitWindow = 60) => {\n  var _data$;\n  if (!data || data.length < 3) return {\n    Qi: (data === null || data === void 0 ? void 0 : (_data$ = data[0]) === null || _data$ === void 0 ? void 0 : _data$.value) || 100,\n    b: 0.9,\n    D: 0.01\n  };\n  const sortedData = [...data].sort((a, b) => a.t - b.t);\n  const Qi = sortedData[0].value;\n  const recentData = sortedData.slice(-Math.min(fitWindow, sortedData.length));\n  let bestB = 0,\n    bestD = 0.01,\n    bestError = Infinity;\n  for (let b = 0; b <= 1; b += 0.1) {\n    const {\n      D,\n      error\n    } = findOptimalD(recentData, Qi, b);\n    if (error < bestError) {\n      bestError = error;\n      bestB = b;\n      bestD = D;\n    }\n  }\n  const minB = Math.max(0, bestB - 0.1);\n  const maxB = Math.min(1, bestB + 0.1);\n  for (let b = minB; b <= maxB; b += 0.01) {\n    const {\n      D,\n      error\n    } = findOptimalD(recentData, Qi, b);\n    if (error < bestError) {\n      bestError = error;\n      bestB = b;\n      bestD = D;\n    }\n  }\n  return {\n    Qi,\n    b: bestB,\n    D: bestD\n  };\n};\nconst findOptimalD = (data, Qi, b) => {\n  let bestD = 0.01,\n    bestError = Infinity;\n  for (let D = 0.001; D <= 0.5; D += 0.005) {\n    let error = 0;\n    data.forEach(d => {\n      const predicted = calculateRate(Qi, b, D, d.t);\n      error += Math.pow(predicted - d.value, 2);\n    });\n    if (error < bestError) {\n      bestError = error;\n      bestD = D;\n    }\n  }\n  const minD = Math.max(0.001, bestD - 0.005);\n  const maxD = bestD + 0.005;\n  for (let D = minD; D <= maxD; D += 0.0005) {\n    let error = 0;\n    data.forEach(d => {\n      const predicted = calculateRate(Qi, b, D, d.t);\n      error += Math.pow(predicted - d.value, 2);\n    });\n    if (error < bestError) {\n      bestError = error;\n      bestD = D;\n    }\n  }\n  return {\n    D: bestD,\n    error: bestError\n  };\n};\nfunction InteractiveDCAChart({\n  dataString,\n  startDate,\n  endDate,\n  colors,\n  yScaleType,\n  yMultiplier,\n  forecastDays,\n  autoForecast = true,\n  onParametersCalculated\n}) {\n  _s();\n  const svgRef = useRef(null);\n\n  // Parse CSV data.\n  const parsedData = useMemo(() => {\n    try {\n      return d3.csvParse(dataString);\n    } catch (err) {\n      console.error(\"Error parsing CSV:\", err);\n      return [];\n    }\n  }, [dataString]);\n  const hasData = parsedData.length > 0;\n  const prodDateCol = hasData ? detectDateColumn(parsedData.columns) : \"Production_Date\";\n  const phasesDetected = hasData ? detectColumns(parsedData.columns) : {};\n  const filteredData = useMemo(() => {\n    if (!hasData) return [];\n    let dataWithDates = parsedData.map(row => ({\n      ...row,\n      [prodDateCol]: new Date(row[prodDateCol])\n    }));\n    dataWithDates = dataWithDates.filter(row => !isNaN(row[prodDateCol].getTime()));\n    dataWithDates.sort((a, b) => a[prodDateCol] - b[prodDateCol]);\n    if (startDate) {\n      const sd = new Date(startDate);\n      dataWithDates = dataWithDates.filter(row => row[prodDateCol] >= sd);\n    }\n    if (endDate) {\n      const ed = new Date(endDate);\n      dataWithDates = dataWithDates.filter(row => row[prodDateCol] <= ed);\n    }\n    return dataWithDates;\n  }, [parsedData, prodDateCol, startDate, endDate, hasData]);\n  const localHasData = filteredData.length > 0;\n  const firstDate = localHasData ? filteredData[0][prodDateCol] : new Date();\n  const data = useMemo(() => {\n    if (!localHasData) return [];\n    return filteredData.map(row => {\n      const date = row[prodDateCol];\n      return {\n        ...row,\n        t: (date - firstDate) / (1000 * 60 * 60 * 24)\n      };\n    });\n  }, [filteredData, localHasData, firstDate, prodDateCol]);\n  const phaseData = useMemo(() => {\n    let result = {};\n    Object.keys(phasesDetected).forEach(phase => {\n      result[phase] = data.map(d => ({\n        t: d.t,\n        value: +d[phasesDetected[phase]]\n      })).filter(d => !isNaN(d.value));\n    });\n    return result;\n  }, [data, phasesDetected]);\n  const tMax = localHasData ? d3.max(data, d => d.t) : 0;\n  const maxProdDate = localHasData ? d3.max(data, d => d[prodDateCol]) : new Date();\n  const [phaseParams, setPhaseParams] = useState({});\n  const [autoFitEnabled, setAutoFitEnabled] = useState(true);\n  const [activeKey, setActiveKey] = useState(null);\n  useEffect(() => {\n    const handleKeyDown = e => {\n      const key = e.key.toLowerCase();\n      if ([\"d\", \"q\", \"b\"].includes(key)) setActiveKey(key);\n    };\n    const handleKeyUp = () => setActiveKey(null);\n    window.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"keyup\", handleKeyUp);\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"keyup\", handleKeyUp);\n    };\n  }, []);\n  useEffect(() => {\n    let newParams = {};\n    Object.keys(phaseData).forEach(phase => {\n      let series = phaseData[phase];\n      if (series.length < 3) {\n        var _series$;\n        newParams[phase] = {\n          Qi: (series === null || series === void 0 ? void 0 : (_series$ = series[0]) === null || _series$ === void 0 ? void 0 : _series$.value) || 100,\n          b: 0.9,\n          D: 0.01\n        };\n      } else {\n        newParams[phase] = fitDeclineParameters(series);\n      }\n    });\n    if (Object.keys(newParams).length > 0 && autoFitEnabled) {\n      setPhaseParams(newParams);\n    }\n  }, [phaseData, autoFitEnabled]);\n  const calculatedEUR = useMemo(() => {\n    let results = {};\n    Object.keys(phaseParams).forEach(phase => {\n      const {\n        Qi,\n        b,\n        D\n      } = phaseParams[phase];\n      if (b === 0) results[phase] = Qi / D;else if (b > 0 && b < 1) results[phase] = Qi / (D * (1 - b));else if (b === 1) results[phase] = Qi * (1 + Math.log(Qi / 1) / D);else results[phase] = \"N/A\";\n    });\n    return results;\n  }, [phaseParams]);\n  useEffect(() => {\n    if (onParametersCalculated) {\n      onParametersCalculated({\n        phaseParams,\n        calculatedEUR\n      });\n    }\n  }, [phaseParams, calculatedEUR, onParametersCalculated]);\n  const allHistoricalPoints = useMemo(() => {\n    let points = [];\n    Object.keys(phaseData).forEach(phase => {\n      phaseData[phase].forEach(d => {\n        points.push({\n          date: new Date(firstDate.getTime() + d.t * 24 * 60 * 60 * 1000),\n          Q: d.value,\n          phase\n        });\n      });\n    });\n    return points;\n  }, [phaseData, firstDate]);\n  const calcForecast = (Qi, b, D, tMaxVal, forecastDaysVal) => {\n    let Qstart = calculateRate(Qi, b, D, tMaxVal);\n    let arr = [];\n    let steps = 50;\n    let lastDate = localHasData ? d3.max(data, d => d[prodDateCol]) : new Date();\n    for (let i = 0; i <= steps; i++) {\n      let tF = forecastDaysVal * i / steps;\n      let q = calculateRate(Qstart, b, D, tF);\n      let dt = new Date(lastDate.getTime() + tF * 24 * 60 * 60 * 1000);\n      arr.push({\n        date: dt,\n        Q: q,\n        t: tF,\n        phase: \"forecast\"\n      });\n    }\n    return arr;\n  };\n  const allForecastPoints = useMemo(() => {\n    let forecasts = {};\n    Object.keys(phaseParams).forEach(phase => {\n      const {\n        Qi,\n        b,\n        D\n      } = phaseParams[phase];\n      if (!Qi || D <= 0) {\n        forecasts[phase] = [];\n      } else {\n        let fc = calcForecast(Qi, b, D, tMax, forecastDays);\n        fc.forEach(x => x.phase = phase);\n        forecasts[phase] = fc;\n      }\n    });\n    return forecasts;\n  }, [phaseParams, tMax, forecastDays, localHasData, data, prodDateCol]);\n  const combinedAll = useMemo(() => {\n    let all = [...allHistoricalPoints];\n    Object.values(allForecastPoints).forEach(arr => all = all.concat(arr));\n    return all;\n  }, [allHistoricalPoints, allForecastPoints]);\n\n  // D3 rendering.\n  useEffect(() => {\n    if (!localHasData) return;\n    const margin = {\n      top: 20,\n      right: 30,\n      bottom: 40,\n      left: 60\n    };\n    const width = 800;\n    const height = 400;\n    const svg = d3.select(svgRef.current);\n    svg.selectAll(\"*\").remove();\n    const [minDateDomain, maxDateDomain] = d3.extent(combinedAll, d => d.date);\n    let [minQ, maxQ] = d3.extent(combinedAll, d => d.Q);\n    if (yScaleType === \"log\" && minQ <= 0) minQ = 1e-2;\n    const xScale = d3.scaleTime().domain([minDateDomain, maxDateDomain]).range([margin.left, width - margin.right]);\n    const yDomain = yScaleType === \"log\" ? [Math.max(1e-5, minQ), maxQ * yMultiplier] : [0, maxQ * yMultiplier];\n    let yScale = yScaleType === \"log\" ? d3.scaleLog().domain(yDomain).range([height - margin.bottom, margin.top]) : d3.scaleLinear().domain(yDomain).range([height - margin.bottom, margin.top]);\n    const xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat(\"%Y-%m-%d\"));\n    const yAxis = yScaleType === \"log\" ? d3.axisLeft(yScale).ticks(6, \"~s\") : d3.axisLeft(yScale);\n    svg.append(\"g\").attr(\"transform\", `translate(0,${height - margin.bottom})`).call(xAxis).selectAll(\"text\").attr(\"transform\", \"rotate(-45)\").style(\"text-anchor\", \"end\");\n    svg.append(\"g\").attr(\"transform\", `translate(${margin.left},0)`).call(yAxis);\n    svg.append(\"text\").attr(\"x\", width / 2).attr(\"y\", height - 5).style(\"text-anchor\", \"middle\").text(\"Date\");\n    svg.append(\"text\").attr(\"transform\", \"rotate(-90)\").attr(\"x\", -height / 2).attr(\"y\", 15).style(\"text-anchor\", \"middle\").text(\"Production Rate\");\n\n    // Plot historical points.\n    Object.keys(phasesDetected).forEach(phase => {\n      const pts = allHistoricalPoints.filter(p => p.phase === phase);\n      svg.selectAll(`circle.hist-${phase}`).data(pts).enter().append(\"circle\").attr(\"cx\", d => xScale(d.date)).attr(\"cy\", d => yScale(d.Q)).attr(\"r\", 3).attr(\"fill\", colors[phase] || \"#888\");\n    });\n\n    // Plot decline lines with drag behavior.\n    Object.keys(phaseParams).forEach(phase => {\n      const {\n        Qi,\n        b,\n        D\n      } = phaseParams[phase];\n      const lineData = [];\n      const steps = 100;\n      for (let i = 0; i <= steps; i++) {\n        const frac = i / steps;\n        const tVal = tMax * frac;\n        const QVal = calculateRate(Qi, b, D, tVal);\n        const dt = new Date(firstDate.getTime() + tVal * 24 * 60 * 60 * 1000);\n        lineData.push({\n          date: dt,\n          Q: QVal\n        });\n      }\n      const lineGen = d3.line().x(d => xScale(d.date)).y(d => yScale(d.Q)).curve(d3.curveMonotoneX);\n      svg.append(\"path\").datum(lineData).attr(\"fill\", \"none\").attr(\"stroke\", colors[phase] || \"#888888\").attr(\"stroke-width\", 2).style(\"cursor\", \"pointer\").attr(\"d\", lineGen).call(d3.drag().on(\"drag\", event => {\n        if (autoFitEnabled) setAutoFitEnabled(false);\n        setPhaseParams(prev => {\n          const newParams = {\n            ...prev\n          };\n          const curr = {\n            ...prev[phase]\n          };\n          if (activeKey === \"d\") {\n            curr.D = Math.max(0.0001, curr.D + event.dy * 0.001);\n          } else if (activeKey === \"q\") {\n            curr.Qi = Math.max(1, curr.Qi - event.dy);\n          } else if (activeKey === \"b\") {\n            curr.b = Math.max(0, Math.min(1, curr.b + event.dy * 0.005));\n          }\n          newParams[phase] = curr;\n          return newParams;\n        });\n      }));\n    });\n\n    // Plot forecast lines.\n    Object.keys(allForecastPoints).forEach(phase => {\n      const fc = allForecastPoints[phase];\n      if (fc.length > 1) {\n        const lineGenFc = d3.line().x(d => xScale(d.date)).y(d => yScale(d.Q)).curve(d3.curveMonotoneX);\n        svg.append(\"path\").datum(fc).attr(\"fill\", \"none\").attr(\"stroke\", d3.color(colors[phase] || \"#888\").brighter(1.2)).attr(\"stroke-width\", 3).attr(\"stroke-dasharray\", \"5,3\").attr(\"d\", lineGenFc);\n      }\n    });\n    svg.append(\"line\").attr(\"x1\", xScale(maxProdDate)).attr(\"y1\", margin.top).attr(\"x2\", xScale(maxProdDate)).attr(\"y2\", height - margin.bottom).attr(\"stroke\", \"#666\").attr(\"stroke-width\", 1).attr(\"stroke-dasharray\", \"5,5\");\n    svg.append(\"text\").attr(\"x\", xScale(maxProdDate) + 5).attr(\"y\", margin.top + 15).attr(\"fill\", \"#666\").text(\"Forecast →\");\n\n    // d3-zoom for vertical scaling.\n    const zoomBehavior = d3.zoom().scaleExtent([0.5, 10]).on(\"zoom\", event => {\n      const newYScale = event.transform.rescaleY(yScale);\n      // Update circles.\n      svg.selectAll(\"circle\").attr(\"cy\", d => newYScale(d.Q));\n      // Update paths by recreating the line generator for each.\n      svg.selectAll(\"path\").each(function (d) {\n        const path = d3.select(this);\n        const newLineGen = d3.line().x(dd => xScale(dd.date)).y(dd => newYScale(dd.Q)).curve(d3.curveMonotoneX);\n        path.attr(\"d\", newLineGen(d));\n      });\n      svg.select(\"g\").call(yAxis.scale(newYScale));\n    });\n    svg.call(zoomBehavior);\n  }, [combinedAll, colors, activeKey, yScaleType, yMultiplier, forecastDays, autoFitEnabled, tMax, firstDate, phasesDetected, phaseParams, allHistoricalPoints, allForecastPoints, maxProdDate]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: 'relative'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: svgRef,\n      width: 800,\n      height: 400\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 473,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 472,\n    columnNumber: 5\n  }, this);\n}\n_s(InteractiveDCAChart, \"VqoYSGuwtxkyq0Xlr+2esOaBpUs=\");\n_c = InteractiveDCAChart;\nexport default InteractiveDCAChart;\nvar _c;\n$RefreshReg$(_c, \"InteractiveDCAChart\");","map":{"version":3,"names":["React","useRef","useEffect","useState","useMemo","d3","jsxDEV","_jsxDEV","darkenColor","hex","factor","c","color","r","Math","floor","g","b","formatHex","lightenColor","min","detectDateColumn","headers","candidates","filter","h","lower","toLowerCase","includes","length","detectColumns","phases","forEach","header","oil","water","gas","pressure","calculateRate","Qi","D","t","exp","pow","fitDeclineParameters","data","fitWindow","_data$","value","sortedData","sort","a","recentData","slice","bestB","bestD","bestError","Infinity","error","findOptimalD","minB","max","maxB","d","predicted","minD","maxD","InteractiveDCAChart","dataString","startDate","endDate","colors","yScaleType","yMultiplier","forecastDays","autoForecast","onParametersCalculated","_s","svgRef","parsedData","csvParse","err","console","hasData","prodDateCol","columns","phasesDetected","filteredData","dataWithDates","map","row","Date","isNaN","getTime","sd","ed","localHasData","firstDate","date","phaseData","result","Object","keys","phase","tMax","maxProdDate","phaseParams","setPhaseParams","autoFitEnabled","setAutoFitEnabled","activeKey","setActiveKey","handleKeyDown","e","key","handleKeyUp","window","addEventListener","removeEventListener","newParams","series","_series$","calculatedEUR","results","log","allHistoricalPoints","points","push","Q","calcForecast","tMaxVal","forecastDaysVal","Qstart","arr","steps","lastDate","i","tF","q","dt","allForecastPoints","forecasts","fc","x","combinedAll","all","values","concat","margin","top","right","bottom","left","width","height","svg","select","current","selectAll","remove","minDateDomain","maxDateDomain","extent","minQ","maxQ","xScale","scaleTime","domain","range","yDomain","yScale","scaleLog","scaleLinear","xAxis","axisBottom","tickFormat","timeFormat","yAxis","axisLeft","ticks","append","attr","call","style","text","pts","p","enter","lineData","frac","tVal","QVal","lineGen","line","y","curve","curveMonotoneX","datum","drag","on","event","prev","curr","dy","lineGenFc","brighter","zoomBehavior","zoom","scaleExtent","newYScale","transform","rescaleY","each","path","newLineGen","dd","scale","position","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/lozan/Desktop/Git/dca-spotfire/frontend/src/InteractiveDCAChart.js"],"sourcesContent":["import React, { useRef, useEffect, useState, useMemo } from 'react';\r\nimport * as d3 from 'd3';\r\n\r\nconst darkenColor = (hex, factor = 0.8) => {\r\n  let c = d3.color(hex);\r\n  if (c) {\r\n    c.r = Math.floor(c.r * factor);\r\n    c.g = Math.floor(c.g * factor);\r\n    c.b = Math.floor(c.b * factor);\r\n    return c.formatHex();\r\n  }\r\n  return hex;\r\n};\r\n\r\nconst lightenColor = (hex, factor = 1.2) => {\r\n  let c = d3.color(hex);\r\n  if (c) {\r\n    c.r = Math.min(255, Math.floor(c.r * factor));\r\n    c.g = Math.min(255, Math.floor(c.g * factor));\r\n    c.b = Math.min(255, Math.floor(c.b * factor));\r\n    return c.formatHex();\r\n  }\r\n  return hex;\r\n};\r\n\r\nconst detectDateColumn = (headers) => {\r\n  const candidates = headers.filter(h => {\r\n    const lower = h.toLowerCase();\r\n    return (\r\n      (lower.includes(\"prod\") && lower.includes(\"date\")) ||\r\n      lower.includes(\"proddt\") ||\r\n      lower.includes(\"proddttm\") ||\r\n      lower === \"date\" ||\r\n      lower === \"datetime\"\r\n    );\r\n  });\r\n  return candidates.length > 0 ? candidates[0] : \"Production_Date\";\r\n};\r\n\r\nconst detectColumns = (headers) => {\r\n  let phases = {};\r\n  headers.forEach(header => {\r\n    const lower = header.toLowerCase();\r\n    if (lower.includes(\"bopd\")) {\r\n      phases.oil = header;\r\n    } else if (lower.includes(\"oil\") && !phases.oil) {\r\n      phases.oil = header;\r\n    }\r\n    if (lower.includes(\"bwpd\")) {\r\n      phases.water = header;\r\n    } else if (lower.includes(\"water\") && !phases.water) {\r\n      phases.water = header;\r\n    }\r\n    if (lower.includes(\"mcfd\")) {\r\n      phases.gas = header;\r\n    } else if (lower.includes(\"gas\") && !phases.gas) {\r\n      phases.gas = header;\r\n    }\r\n    if ((lower.includes(\"pip\") || lower.includes(\"pressure\") || lower.includes(\"psi\")) && !phases.pressure) {\r\n      phases.pressure = header;\r\n    }\r\n  });\r\n  return phases;\r\n};\r\n\r\nconst calculateRate = (Qi, b, D, t) => {\r\n  if (b === 0) {\r\n    return Qi * Math.exp(-D * t);\r\n  } else {\r\n    return Qi / Math.pow(1 + b * D * t, 1 / b);\r\n  }\r\n};\r\n\r\nconst fitDeclineParameters = (data, fitWindow = 60) => {\r\n  if (!data || data.length < 3) return { Qi: data?.[0]?.value || 100, b: 0.9, D: 0.01 };\r\n  const sortedData = [...data].sort((a, b) => a.t - b.t);\r\n  const Qi = sortedData[0].value;\r\n  const recentData = sortedData.slice(-Math.min(fitWindow, sortedData.length));\r\n  let bestB = 0, bestD = 0.01, bestError = Infinity;\r\n  for (let b = 0; b <= 1; b += 0.1) {\r\n    const { D, error } = findOptimalD(recentData, Qi, b);\r\n    if (error < bestError) {\r\n      bestError = error;\r\n      bestB = b;\r\n      bestD = D;\r\n    }\r\n  }\r\n  const minB = Math.max(0, bestB - 0.1);\r\n  const maxB = Math.min(1, bestB + 0.1);\r\n  for (let b = minB; b <= maxB; b += 0.01) {\r\n    const { D, error } = findOptimalD(recentData, Qi, b);\r\n    if (error < bestError) {\r\n      bestError = error;\r\n      bestB = b;\r\n      bestD = D;\r\n    }\r\n  }\r\n  return { Qi, b: bestB, D: bestD };\r\n};\r\n\r\nconst findOptimalD = (data, Qi, b) => {\r\n  let bestD = 0.01, bestError = Infinity;\r\n  for (let D = 0.001; D <= 0.5; D += 0.005) {\r\n    let error = 0;\r\n    data.forEach(d => {\r\n      const predicted = calculateRate(Qi, b, D, d.t);\r\n      error += Math.pow(predicted - d.value, 2);\r\n    });\r\n    if (error < bestError) {\r\n      bestError = error;\r\n      bestD = D;\r\n    }\r\n  }\r\n  const minD = Math.max(0.001, bestD - 0.005);\r\n  const maxD = bestD + 0.005;\r\n  for (let D = minD; D <= maxD; D += 0.0005) {\r\n    let error = 0;\r\n    data.forEach(d => {\r\n      const predicted = calculateRate(Qi, b, D, d.t);\r\n      error += Math.pow(predicted - d.value, 2);\r\n    });\r\n    if (error < bestError) {\r\n      bestError = error;\r\n      bestD = D;\r\n    }\r\n  }\r\n  return { D: bestD, error: bestError };\r\n};\r\n\r\nfunction InteractiveDCAChart({\r\n  dataString,\r\n  startDate,\r\n  endDate,\r\n  colors,\r\n  yScaleType,\r\n  yMultiplier,\r\n  forecastDays,\r\n  autoForecast = true,\r\n  onParametersCalculated\r\n}) {\r\n  const svgRef = useRef(null);\r\n\r\n  // Parse CSV data.\r\n  const parsedData = useMemo(() => {\r\n    try {\r\n      return d3.csvParse(dataString);\r\n    } catch (err) {\r\n      console.error(\"Error parsing CSV:\", err);\r\n      return [];\r\n    }\r\n  }, [dataString]);\r\n\r\n  const hasData = parsedData.length > 0;\r\n  const prodDateCol = hasData ? detectDateColumn(parsedData.columns) : \"Production_Date\";\r\n  const phasesDetected = hasData ? detectColumns(parsedData.columns) : {};\r\n  const filteredData = useMemo(() => {\r\n    if (!hasData) return [];\r\n    let dataWithDates = parsedData.map(row => ({\r\n      ...row,\r\n      [prodDateCol]: new Date(row[prodDateCol])\r\n    }));\r\n    dataWithDates = dataWithDates.filter(row => !isNaN(row[prodDateCol].getTime()));\r\n    dataWithDates.sort((a, b) => a[prodDateCol] - b[prodDateCol]);\r\n    if (startDate) {\r\n      const sd = new Date(startDate);\r\n      dataWithDates = dataWithDates.filter(row => row[prodDateCol] >= sd);\r\n    }\r\n    if (endDate) {\r\n      const ed = new Date(endDate);\r\n      dataWithDates = dataWithDates.filter(row => row[prodDateCol] <= ed);\r\n    }\r\n    return dataWithDates;\r\n  }, [parsedData, prodDateCol, startDate, endDate, hasData]);\r\n\r\n  const localHasData = filteredData.length > 0;\r\n  const firstDate = localHasData ? filteredData[0][prodDateCol] : new Date();\r\n\r\n  const data = useMemo(() => {\r\n    if (!localHasData) return [];\r\n    return filteredData.map(row => {\r\n      const date = row[prodDateCol];\r\n      return { ...row, t: (date - firstDate) / (1000 * 60 * 60 * 24) };\r\n    });\r\n  }, [filteredData, localHasData, firstDate, prodDateCol]);\r\n\r\n  const phaseData = useMemo(() => {\r\n    let result = {};\r\n    Object.keys(phasesDetected).forEach(phase => {\r\n      result[phase] = data.map(d => ({\r\n        t: d.t,\r\n        value: +d[phasesDetected[phase]]\r\n      })).filter(d => !isNaN(d.value));\r\n    });\r\n    return result;\r\n  }, [data, phasesDetected]);\r\n\r\n  const tMax = localHasData ? d3.max(data, d => d.t) : 0;\r\n  const maxProdDate = localHasData\r\n    ? d3.max(data, d => d[prodDateCol])\r\n    : new Date();\r\n\r\n  const [phaseParams, setPhaseParams] = useState({});\r\n  const [autoFitEnabled, setAutoFitEnabled] = useState(true);\r\n  const [activeKey, setActiveKey] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      const key = e.key.toLowerCase();\r\n      if ([\"d\", \"q\", \"b\"].includes(key)) setActiveKey(key);\r\n    };\r\n    const handleKeyUp = () => setActiveKey(null);\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    window.addEventListener(\"keyup\", handleKeyUp);\r\n    return () => {\r\n      window.removeEventListener(\"keydown\", handleKeyDown);\r\n      window.removeEventListener(\"keyup\", handleKeyUp);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let newParams = {};\r\n    Object.keys(phaseData).forEach(phase => {\r\n      let series = phaseData[phase];\r\n      if (series.length < 3) {\r\n        newParams[phase] = { Qi: series?.[0]?.value || 100, b: 0.9, D: 0.01 };\r\n      } else {\r\n        newParams[phase] = fitDeclineParameters(series);\r\n      }\r\n    });\r\n    if (Object.keys(newParams).length > 0 && autoFitEnabled) {\r\n      setPhaseParams(newParams);\r\n    }\r\n  }, [phaseData, autoFitEnabled]);\r\n\r\n  const calculatedEUR = useMemo(() => {\r\n    let results = {};\r\n    Object.keys(phaseParams).forEach(phase => {\r\n      const { Qi, b, D } = phaseParams[phase];\r\n      if (b === 0) results[phase] = Qi / D;\r\n      else if (b > 0 && b < 1) results[phase] = Qi / (D * (1 - b));\r\n      else if (b === 1) results[phase] = Qi * (1 + Math.log(Qi / 1) / D);\r\n      else results[phase] = \"N/A\";\r\n    });\r\n    return results;\r\n  }, [phaseParams]);\r\n\r\n  useEffect(() => {\r\n    if (onParametersCalculated) {\r\n      onParametersCalculated({ phaseParams, calculatedEUR });\r\n    }\r\n  }, [phaseParams, calculatedEUR, onParametersCalculated]);\r\n\r\n  const allHistoricalPoints = useMemo(() => {\r\n    let points = [];\r\n    Object.keys(phaseData).forEach(phase => {\r\n      phaseData[phase].forEach(d => {\r\n        points.push({\r\n          date: new Date(firstDate.getTime() + d.t * 24 * 60 * 60 * 1000),\r\n          Q: d.value,\r\n          phase\r\n        });\r\n      });\r\n    });\r\n    return points;\r\n  }, [phaseData, firstDate]);\r\n\r\n  const calcForecast = (Qi, b, D, tMaxVal, forecastDaysVal) => {\r\n    let Qstart = calculateRate(Qi, b, D, tMaxVal);\r\n    let arr = [];\r\n    let steps = 50;\r\n    let lastDate = localHasData ? d3.max(data, d => d[prodDateCol]) : new Date();\r\n    for (let i = 0; i <= steps; i++) {\r\n      let tF = (forecastDaysVal * i) / steps;\r\n      let q = calculateRate(Qstart, b, D, tF);\r\n      let dt = new Date(lastDate.getTime() + tF * 24 * 60 * 60 * 1000);\r\n      arr.push({ date: dt, Q: q, t: tF, phase: \"forecast\" });\r\n    }\r\n    return arr;\r\n  };\r\n\r\n  const allForecastPoints = useMemo(() => {\r\n    let forecasts = {};\r\n    Object.keys(phaseParams).forEach(phase => {\r\n      const { Qi, b, D } = phaseParams[phase];\r\n      if (!Qi || D <= 0) {\r\n        forecasts[phase] = [];\r\n      } else {\r\n        let fc = calcForecast(Qi, b, D, tMax, forecastDays);\r\n        fc.forEach(x => (x.phase = phase));\r\n        forecasts[phase] = fc;\r\n      }\r\n    });\r\n    return forecasts;\r\n  }, [phaseParams, tMax, forecastDays, localHasData, data, prodDateCol]);\r\n\r\n  const combinedAll = useMemo(() => {\r\n    let all = [...allHistoricalPoints];\r\n    Object.values(allForecastPoints).forEach(arr => (all = all.concat(arr)));\r\n    return all;\r\n  }, [allHistoricalPoints, allForecastPoints]);\r\n\r\n  // D3 rendering.\r\n  useEffect(() => {\r\n    if (!localHasData) return;\r\n    const margin = { top: 20, right: 30, bottom: 40, left: 60 };\r\n    const width = 800;\r\n    const height = 400;\r\n    const svg = d3.select(svgRef.current);\r\n    svg.selectAll(\"*\").remove();\r\n    const [minDateDomain, maxDateDomain] = d3.extent(combinedAll, d => d.date);\r\n    let [minQ, maxQ] = d3.extent(combinedAll, d => d.Q);\r\n    if (yScaleType === \"log\" && minQ <= 0) minQ = 1e-2;\r\n    const xScale = d3.scaleTime()\r\n      .domain([minDateDomain, maxDateDomain])\r\n      .range([margin.left, width - margin.right]);\r\n    const yDomain = yScaleType === \"log\"\r\n      ? [Math.max(1e-5, minQ), maxQ * yMultiplier]\r\n      : [0, maxQ * yMultiplier];\r\n    let yScale = yScaleType === \"log\"\r\n      ? d3.scaleLog().domain(yDomain).range([height - margin.bottom, margin.top])\r\n      : d3.scaleLinear().domain(yDomain).range([height - margin.bottom, margin.top]);\r\n    const xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat(\"%Y-%m-%d\"));\r\n    const yAxis = yScaleType === \"log\"\r\n      ? d3.axisLeft(yScale).ticks(6, \"~s\")\r\n      : d3.axisLeft(yScale);\r\n    svg.append(\"g\")\r\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\r\n      .call(xAxis)\r\n      .selectAll(\"text\")\r\n      .attr(\"transform\", \"rotate(-45)\")\r\n      .style(\"text-anchor\", \"end\");\r\n    svg.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},0)`)\r\n      .call(yAxis);\r\n    svg.append(\"text\")\r\n      .attr(\"x\", width / 2)\r\n      .attr(\"y\", height - 5)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .text(\"Date\");\r\n    svg.append(\"text\")\r\n      .attr(\"transform\", \"rotate(-90)\")\r\n      .attr(\"x\", -height / 2)\r\n      .attr(\"y\", 15)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .text(\"Production Rate\");\r\n    \r\n    // Plot historical points.\r\n    Object.keys(phasesDetected).forEach(phase => {\r\n      const pts = allHistoricalPoints.filter(p => p.phase === phase);\r\n      svg.selectAll(`circle.hist-${phase}`)\r\n        .data(pts)\r\n        .enter()\r\n        .append(\"circle\")\r\n        .attr(\"cx\", d => xScale(d.date))\r\n        .attr(\"cy\", d => yScale(d.Q))\r\n        .attr(\"r\", 3)\r\n        .attr(\"fill\", colors[phase] || \"#888\");\r\n    });\r\n    \r\n    // Plot decline lines with drag behavior.\r\n    Object.keys(phaseParams).forEach(phase => {\r\n      const { Qi, b, D } = phaseParams[phase];\r\n      const lineData = [];\r\n      const steps = 100;\r\n      for (let i = 0; i <= steps; i++) {\r\n        const frac = i / steps;\r\n        const tVal = tMax * frac;\r\n        const QVal = calculateRate(Qi, b, D, tVal);\r\n        const dt = new Date(firstDate.getTime() + tVal * 24 * 60 * 60 * 1000);\r\n        lineData.push({ date: dt, Q: QVal });\r\n      }\r\n      const lineGen = d3.line()\r\n        .x(d => xScale(d.date))\r\n        .y(d => yScale(d.Q))\r\n        .curve(d3.curveMonotoneX);\r\n      svg.append(\"path\")\r\n        .datum(lineData)\r\n        .attr(\"fill\", \"none\")\r\n        .attr(\"stroke\", colors[phase] || \"#888888\")\r\n        .attr(\"stroke-width\", 2)\r\n        .style(\"cursor\", \"pointer\")\r\n        .attr(\"d\", lineGen)\r\n        .call(\r\n          d3.drag().on(\"drag\", (event) => {\r\n            if (autoFitEnabled) setAutoFitEnabled(false);\r\n            setPhaseParams(prev => {\r\n              const newParams = { ...prev };\r\n              const curr = { ...prev[phase] };\r\n              if (activeKey === \"d\") {\r\n                curr.D = Math.max(0.0001, curr.D + event.dy * 0.001);\r\n              } else if (activeKey === \"q\") {\r\n                curr.Qi = Math.max(1, curr.Qi - event.dy);\r\n              } else if (activeKey === \"b\") {\r\n                curr.b = Math.max(0, Math.min(1, curr.b + event.dy * 0.005));\r\n              }\r\n              newParams[phase] = curr;\r\n              return newParams;\r\n            });\r\n          })\r\n        );\r\n    });\r\n    \r\n    // Plot forecast lines.\r\n    Object.keys(allForecastPoints).forEach(phase => {\r\n      const fc = allForecastPoints[phase];\r\n      if (fc.length > 1) {\r\n        const lineGenFc = d3.line()\r\n          .x(d => xScale(d.date))\r\n          .y(d => yScale(d.Q))\r\n          .curve(d3.curveMonotoneX);\r\n        svg.append(\"path\")\r\n          .datum(fc)\r\n          .attr(\"fill\", \"none\")\r\n          .attr(\"stroke\", d3.color(colors[phase] || \"#888\").brighter(1.2))\r\n          .attr(\"stroke-width\", 3)\r\n          .attr(\"stroke-dasharray\", \"5,3\")\r\n          .attr(\"d\", lineGenFc);\r\n      }\r\n    });\r\n    \r\n    svg.append(\"line\")\r\n      .attr(\"x1\", xScale(maxProdDate))\r\n      .attr(\"y1\", margin.top)\r\n      .attr(\"x2\", xScale(maxProdDate))\r\n      .attr(\"y2\", height - margin.bottom)\r\n      .attr(\"stroke\", \"#666\")\r\n      .attr(\"stroke-width\", 1)\r\n      .attr(\"stroke-dasharray\", \"5,5\");\r\n    svg.append(\"text\")\r\n      .attr(\"x\", xScale(maxProdDate) + 5)\r\n      .attr(\"y\", margin.top + 15)\r\n      .attr(\"fill\", \"#666\")\r\n      .text(\"Forecast →\");\r\n    \r\n    // d3-zoom for vertical scaling.\r\n    const zoomBehavior = d3.zoom()\r\n      .scaleExtent([0.5, 10])\r\n      .on(\"zoom\", (event) => {\r\n        const newYScale = event.transform.rescaleY(yScale);\r\n        // Update circles.\r\n        svg.selectAll(\"circle\").attr(\"cy\", d => newYScale(d.Q));\r\n        // Update paths by recreating the line generator for each.\r\n        svg.selectAll(\"path\").each(function(d) {\r\n          const path = d3.select(this);\r\n          const newLineGen = d3.line()\r\n            .x(dd => xScale(dd.date))\r\n            .y(dd => newYScale(dd.Q))\r\n            .curve(d3.curveMonotoneX);\r\n          path.attr(\"d\", newLineGen(d));\r\n        });\r\n        svg.select(\"g\").call(yAxis.scale(newYScale));\r\n      });\r\n    svg.call(zoomBehavior);\r\n  }, [\r\n    combinedAll,\r\n    colors,\r\n    activeKey,\r\n    yScaleType,\r\n    yMultiplier,\r\n    forecastDays,\r\n    autoFitEnabled,\r\n    tMax,\r\n    firstDate,\r\n    phasesDetected,\r\n    phaseParams,\r\n    allHistoricalPoints,\r\n    allForecastPoints,\r\n    maxProdDate\r\n  ]);\r\n\r\n  return (\r\n    <div style={{ position: 'relative' }}>\r\n      <svg ref={svgRef} width={800} height={400} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default InteractiveDCAChart;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}